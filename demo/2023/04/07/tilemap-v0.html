<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>TileMap Automata</title><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="TileMap Automata" />
<meta name="author" content="Joel Schutz" />
<meta property="og:locale" content="pt_br" />
<meta name="description" content="Nessa demo utilizamos o mesmo Automata da demo diffusion-automata-v1, mas usamos um mapa do Tiled para renderizar o quadro. Além disso usamos um esquema simples de camera para permitir zoom(mouse wheel) e pan(middle button) do mapa, assim como adicionar(left button) e remover(right button) rochas do mapa." />
<meta property="og:description" content="Nessa demo utilizamos o mesmo Automata da demo diffusion-automata-v1, mas usamos um mapa do Tiled para renderizar o quadro. Além disso usamos um esquema simples de camera para permitir zoom(mouse wheel) e pan(middle button) do mapa, assim como adicionar(left button) e remover(right button) rochas do mapa." />
<link rel="canonical" href="https://github.com/devlog/demo/2023/04/07/tilemap-v0.html" />
<meta property="og:url" content="https://github.com/devlog/demo/2023/04/07/tilemap-v0.html" />
<meta property="og:site_name" content="Joel’s Dev Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-07T22:28:10+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TileMap Automata" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Joel Schutz"},"dateModified":"2023-04-07T22:28:10+00:00","datePublished":"2023-04-07T22:28:10+00:00","description":"Nessa demo utilizamos o mesmo Automata da demo diffusion-automata-v1, mas usamos um mapa do Tiled para renderizar o quadro. Além disso usamos um esquema simples de camera para permitir zoom(mouse wheel) e pan(middle button) do mapa, assim como adicionar(left button) e remover(right button) rochas do mapa.","headline":"TileMap Automata","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/devlog/demo/2023/04/07/tilemap-v0.html"},"url":"https://github.com/devlog/demo/2023/04/07/tilemap-v0.html"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="https://github.com/devlog/feed.xml" title="Joel's Dev Blog" /><link rel="shortcut icon" type="image/x-icon" href="/devlog/favicon.ico" />
  <link rel="stylesheet" href="/devlog/assets/css/main.css" />
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head><body a="dark">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/devlog/">../</a><article>
  <p class="post-meta">
    <time datetime="2023-04-07 22:28:10 +0000">Apr-07-2023</time>
  </p><p class="languages">
    
        
    pt-br
        
    
        
            
    <a href="/devlog/en/demo/2023/04/07/tilemap-v0.html">en</a>
            
        
    
    </p><p>
    <iframe frameborder="0" scrolling="no" src="/devlog/assets/wasm/Tilemap/tilemap.html" srcdoc="
    <!DOCTYPE html>
      <script src=&quot;/devlog/assets/wasm/wasm_exec.js&quot;></script>
      <script>
      // Polyfill
      if (!WebAssembly.instantiateStreaming) {
          WebAssembly.instantiateStreaming = async (resp, importObject) => {
              const source = await (await resp).arrayBuffer();
              return await WebAssembly.instantiate(source, importObject);
          };
      }
      
      const go = new Go();
      WebAssembly.instantiateStreaming(fetch(&quot;/devlog/assets/wasm/Tilemap/tilemap.v0.wasm&quot;), go.importObject).then(result => {
          go.run(result.instance);
      });
      </script>" width="100%" height="480"></iframe>
  </p><h1>TileMap Automata</h1>

  <p>Nessa demo utilizamos o mesmo Automata da demo <a href="/devlog/demo/2023/03/23/diffusion-automata-v1.html">diffusion-automata-v1</a>, mas usamos um mapa do Tiled para renderizar o quadro. Além disso usamos um esquema simples de camera para permitir zoom(mouse wheel) e pan(middle button) do mapa, assim como adicionar(left button) e remover(right button) rochas do mapa.</p>

<p>Nossa struct então vai ser bastante simples, precisamos apenas do AUtomata e do TileMap:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">TileBoard</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">tMap</span>   <span class="o">*</span><span class="n">tiled</span><span class="o">.</span><span class="n">Map</span>
	<span class="n">b</span>      <span class="o">*</span><span class="n">boards</span><span class="o">.</span><span class="n">HumidityBoard</span>
	<span class="n">cursor</span> <span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="kt">int</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Durante o update apenas atualizamos o estado do automata e traduzimos esses estados para o TileMap. Se antes cada célula do nosso espaço correspondia a um pixel, aqui ele corresponde a um tile; uma cor corresponde a um tipo de tile e assim por diante.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">tb</span> <span class="o">*</span><span class="n">TileBoard</span><span class="p">)</span> <span class="n">Update</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="c">// Atualizamos o estado do Automato</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">tb</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">err</span>
	<span class="p">}</span>

	<span class="c">// Extraímos o novo estado</span>
	<span class="n">bState</span> <span class="o">:=</span> <span class="n">tb</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">GetState</span><span class="p">()</span>

	<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">:=</span> <span class="n">tb</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">Size</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">width</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">{</span>
		<span class="k">for</span> <span class="n">y</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span> <span class="p">{</span>
			<span class="n">humidity</span><span class="p">,</span> <span class="n">impermeability</span> <span class="o">:=</span> <span class="n">bState</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">Elem</span><span class="p">()</span>
			<span class="c">// Aplicamos o valor da umidade na primeira camada</span>
			<span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Layers</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">.</span><span class="n">Tiles</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Width</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tiled</span><span class="o">.</span><span class="n">LayerTile</span><span class="p">{</span><span class="n">Tileset</span><span class="o">:</span> <span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Tilesets</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">ID</span><span class="o">:</span> <span class="kt">uint32</span><span class="p">(</span><span class="n">humidity</span> <span class="o">/</span> <span class="m">128</span><span class="p">)}</span>
			<span class="c">// Aplicamos o valor da impermeabilidade na segunda camada</span>
			<span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Layers</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">.</span><span class="n">Tiles</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Width</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tiled</span><span class="o">.</span><span class="n">LayerTile</span><span class="p">{</span><span class="n">Tileset</span><span class="o">:</span> <span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Tilesets</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">ID</span><span class="o">:</span> <span class="m">838</span><span class="p">,</span> <span class="n">Nil</span><span class="o">:</span> <span class="n">impermeability</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">MaxFloat32</span><span class="o">/</span><span class="m">5</span><span class="p">)</span><span class="o">*</span><span class="m">4</span><span class="p">}</span>
			<span class="c">// Atualizamos a posição do cursos na terceira camada</span>
			<span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Layers</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">.</span><span class="n">Tiles</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Width</span><span class="o">*</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tiled</span><span class="o">.</span><span class="n">LayerTile</span><span class="p">{</span><span class="n">Tileset</span><span class="o">:</span> <span class="n">tb</span><span class="o">.</span><span class="n">tMap</span><span class="o">.</span><span class="n">Tilesets</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">ID</span><span class="o">:</span> <span class="m">847</span><span class="p">,</span> <span class="n">Nil</span><span class="o">:</span> <span class="o">!</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">tb</span><span class="o">.</span><span class="n">cursor</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="n">tb</span><span class="o">.</span><span class="n">cursor</span><span class="p">[</span><span class="m">1</span><span class="p">])}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div></div>

</article>
      </div>
    </main><script data-goatcounter="https://joelschutz.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

<noscript>
  <img src="https://joelschutz.goatcounter.com/count?p=/test-img">
</noscript>
  </body>
</html>